#!/usr/bin/env bash

if [ -f "$HOME/.zhistory" ]; then
    HIST_FILE="$HOME/.zhistory"
    # Strip timestamp prefix, reverse to get newest first, remove duplicates (keep first=newer), reverse back
    history_list=$(LC_ALL=C sed 's/^: [0-9]*:[0-9]*;//' "$HIST_FILE" | tail -r | awk '!seen[$0]++' | tail -r)

elif [ -f "$HOME/.bash_history" ]; then
    HIST_FILE="$HOME/.bash_history"
    # Reverse to get newest first, remove duplicates (keep first=newer), reverse back
    history_list=$(tail -r "$HIST_FILE" | awk '!seen[$0]++' | tail -r)

else
    echo "No history file found."
    exit 1
fi

# Feed to fzf (reverse order to show newest first)
selected=$(echo "$history_list" | tail -r | fzf --height 40% --reverse --border --ansi)

# Use the selected command directly
cmd="$selected"

if [ -n "$cmd" ]; then
    echo "$cmd"
    eval "$cmd"
fi
